<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Shot Histogram Viewer</title>
<style>
    body {
        font-family: Arial;
        margin: auto;
    }

    .controls {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 10px;
    }

    select, button {
        padding: 8px;
        font-size: 1rem;
    }

    .plots-wrapper {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        justify-content: center;
    }

    .plot-container {
        text-align: center;
        flex: 1 1 400px;
    }

    img {
        max-width: 100%;
        height: auto;
        border: 1px solid #ddd;
        padding: 6px;
        margin-top: 10px;
    }

    @media (max-width: 850px) {
    .plots-wrapper { flex-direction: column; }
    }

    /* Style the header */
    .header {
        padding: 40px;
        text-align: center;
        background: #cf7f51;
        color: white;
        border-bottom: solid black
    }

        /* Increase the font size of the h1 element */
        .header h1 {
            font-size: 34px;
        }

        /* Set the font size of the p element */
        .header p {
            font-size: 20px;
        }

        /* Set the link colours */
        /* unvisited */
        .header a:link{
            color: yellow;
        }
        .header a:visited{
            color: black;
        }
        .header a:hover{
            color: yellow;
        }

        .top-link {
          text-decoration: none; /* removes default styling of the link. Underline etc.) */
          background-color: green; /* obvious */
          color: white; /* text color */
          margin: 1rem; /* adding 1rem of space around the button in all directions */
          padding: 0.5rem 1rem; /* Adding space between the text and the border (first value is top and bottom. Second value is right and left) */
          border-radius: 0.5rem; /* rounding the edges */
        }


    /* Main column */
    .main {
            flex: 60%; /* Set the width of the main content */
            background-color: white; /* White background color */
            padding-top: 40px;
            padding-left: 25%;
            padding-right: 25%;
            line-height: 1.5;
        }

            /* Increase the font size of the h1 element */
            .main h1 {
                padding-top: 16px;
                font-size: 16px;
                font-weight: bold;
                text-decoration: underline;
            }

    /* plots column */
    .plots {
            flex: 80%; /* Set the width of the main content */
            background-color: white; /* White background color */
            padding-left: 20%;
            padding-right: 20%;
            line-height: 1.5;
        }

    /* For mobile: reduce padding */
    @media (max-width: 768px) {
        .main {
            padding-left: 40px;
            padding-right: 40px;
        }
        .plots {
            padding-left: 40px;
            padding-right: 40px;
        }
    }

    #analysis-description {
        background: #f8f8f8;
        padding: 10px 14px;
        border-left: 5px solid #3366cc;
        border-radius: 4px;
        margin-bottom: 15px;
    }

    .dropdown-block {
        display: inline-block;
        margin-right: 15px;
    }

    .dropdown-title {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 3px;
        text-align: left;
    }

</style>
</head>
<body>

<div class="header">
    <h1>The effect of various conditions on shot outcomes in the NHL</h1>
    <a href="https://github.com/rucskajj/Data-Science-Projects/tree/main/NHL/xG" class="top-link">Link to code</a>
    <p>Joey Rucska</p>
    <p>Last updated on November 11, 2025.</p>
</div>



<div class="main">

    <h2>Plot Viewer</h2>

    <!-- Analysis Dropdown -->
    <div class="controls">
    <label for="analysis-select">Analysis:</label>
    <select id="analysis-select"></select>
    </div>

    <div id="analysis-description">
        <!-- Analysis description will appear here -->
    </div>

    <!-- Condition, Value, Event Dropdowns + Contours-Hists Download Button -->
    <div class="controls">
        <div class="dropdown-block">
            <div class="dropdown-title" id="condition-title">Condition</div>
            <select id="condition-select"></select>
        </div>

        <div class="dropdown-block">
            <div class="dropdown-title" id="value-title">Value</div>
            <select id="value-select"></select>
        </div>

        <div class="dropdown-block">
            <div class="dropdown-title" id="event-title">Event</div>
            <select id="event-select"></select>
        </div>
    </div>




    <!-- Toggle Buttons -->
    <div class="controls">
    <button id="toggle-contours" type="button">Show/Hide Contours-Hists</button>
    <button id="toggle-2d" type="button">Show/Hide 2D Histogram</button>
    </div>
</div>

<div class="plots">
    <!-- Plots wrapper -->
    <div class="plots-wrapper">
    <!-- Contours-Hists Plot -->
    <div class="plot-container" id="contours-container">
        <h3>Contours-Hists Plot</h3>
        <img id="hist-img" src="" alt="Contours Histogram">
        <div class="controls" style="justify-content:center; margin-top:10px;">
            <button id="download-btn" type="button">Download Contours-Hists Plot</button>
        </div>
    </div>

    <!-- 2Dhists Plot -->
    <div class="plot-container" id="hist2d-container">
        <h3>2D Histogram Plot</h3>
        <img id="hist2d-img" src="" alt="2D Histogram">
        <div class="controls" style="justify-content:center; margin-top:10px;">
            <button id="download2d-btn" type="button">Download 2D Histogram Plot</button>
        </div>
    </div>
    </div>

</div>

<script>

/* ---- Human-readable labels ---- */
const conditionLabels = {
  PlayingStrength: "Strength Situation",
  anglesign: "Shot Angle Side",
  bForwardPlayer: "Forward Shooter",
  bOffWing: "Off-Wing Shot",
  bPlayoffs: "Playoff Game",
  bReb: "Rebound Shot",
  type: "Shot Type"
};

const valueLabels = {
  "Neg": "Right",
  "Pos": "Left",
  "1": "Yes",
  "0": "No",
  "3v3": "3v3",
  "4v4": "4v4",
  "4v5": "4v5 (PK)",
  "5v3": "5v3 (PP)",
  "5v4": "5v4 (PP)",
  "5v5": "5v5 (Even)",
  "6v5": "6v5 (Extra Attacker)",
  BACK: "Backhand",
  DEFL: "Deflection",
  SLAP: "Slap Shot",
  SNAP: "Snap Shot",
  TIP: "Tip-In",
  WRAP: "Wraparound",
  WRIST: "Wrist Shot"
};

const eventLabels = {
  SAT: "Shot Attempts",
  SOG: "Shots on Goal",
  goal: "Goals",
  miss: "Missed Shots"
};

const analysisLabels = {
    "A1": "Analysis 1",
    "A2": "Analysis 2",
    "A3": "Analysis 3"
};


/* ---- Descriptions for each analysis ---- */
const analysisDescriptions = {
  "A1": `
    <strong>Shots by Strength & Type</strong>
    <ul>
      <li>Includes even-strength, power play, and shorthanded situations</li>
      <li>All shot types are categorized</li>
      <li>Data spans multiple seasons and all NHL teams</li>
    </ul>
  `,
  "A2": `
    <strong>Rebound & Follow-up Shot Behavior</strong>
    <ul>
      <li>Identifies second attempts within two seconds of a shot</li>
      <li>Includes blocked attempts leading to loose pucks</li>
      <li>Classifies rebounds based on shot danger and angle</li>
    </ul>
  `,
  "A3": `
    <strong>Playoff vs Regular Season Shot Quality</strong>
    <p>This model examines differences in:</p>
    <ul>
      <li>Shot danger distribution</li>
      <li>Angle selection</li>
      <li>Blocker vs glove probability</li>
    </ul>
  `
};

/* ---- DOM elements ---- */
const analysisSel = document.getElementById("analysis-select");
const condSel = document.getElementById("condition-select");
const valSel = document.getElementById("value-select");
const evtSel = document.getElementById("event-select");
const img = document.getElementById("hist-img");
const img2d = document.getElementById("hist2d-img");
const downloadBtn = document.getElementById("download-btn");
const download2dBtn = document.getElementById("download2d-btn");
const contoursContainer = document.getElementById("contours-container");
const hist2dContainer = document.getElementById("hist2d-container");
const toggleContoursBtn = document.getElementById("toggle-contours");
const toggle2dBtn = document.getElementById("toggle-2d");

/* ---- Reference dataset ---- */
const referenceLabel = "ref";

/* ---- Load file map ---- */
let fileMap = {}; 

fetch("analyses_filemap.json")
  .then(response => response.json())
  .then(data => {
    fileMap = data;

    Object.keys(fileMap).forEach(a => {
        analysisSel.add(new Option(analysisLabels[a] || a, a));
    });

    updateConditionDropdown();
    updateAnalysisDescription();
  });

/* ---- Helper functions ---- */
function getAvailableConditions(analysisFiles) {
  const conds = new Set();
  analysisFiles.forEach(f => {
    const parts = f.split("-");
    if (parts[0] !== "ref") conds.add(parts[0]);
  });
  return Array.from(conds);
}

function getAvailableValues(cond, analysisFiles) {
  const values = new Set();
  analysisFiles.forEach(f => {
    const parts = f.split("-");
    if (parts[0] === cond) values.add(parts[1]);
  });
  return Array.from(values);
}

function getAvailableEvents(cond, val, analysisFiles) {
  const evts = new Set();
  analysisFiles.forEach(f => {
    const parts = f.split("-");
    if (cond === referenceLabel) {
      if (f.startsWith("ref-")) evts.add(parts[1].replace(".png",""));
    } else if (parts[0] === cond && parts[1] === val) {
      evts.add(parts[2].replace(".png",""));
    }
  });
  return Array.from(evts);
}

/* ---- Update Dropdowns ---- */
function updateConditionDropdown() {
    condSel.innerHTML = "";

    const analysisFiles = fileMap[analysisSel.value];
    condSel.add(new Option("Reference Data", referenceLabel));
    const conds = getAvailableConditions(analysisFiles);
    conds.forEach(c => condSel.add(new Option(conditionLabels[c] || c, c)));

    updateValueDropdown();
}

function updateValueDropdown() {
    const cond = condSel.value;
    const analysisFiles = fileMap[analysisSel.value];
    const valueTitle = document.getElementById("value-title");

    if (cond === referenceLabel) {
        // Hide the value dropdown and its title for reference data
        valSel.style.display = "none";
        valueTitle.style.display = "none";
    } else {
        // Show the value dropdown and its title for normal conditions
        valSel.style.display = "inline-block";
        valueTitle.style.display = "block";

        // Populate values normally
        valSel.innerHTML = "";
        const values = getAvailableValues(cond, analysisFiles);
        values.forEach(v => valSel.add(new Option(valueLabels[v] || v, v)));
    }

    updateEventDropdown();
}


function updateEventDropdown() {
  evtSel.innerHTML = "";
  const cond = condSel.value;
  const analysisFiles = fileMap[analysisSel.value];

  // Desired fixed order:
  const eventOrder = ["SAT", "SOG", "miss", "goal"];

  // Determine which events are available
  let evts = [];
  if (cond === referenceLabel) {
    evts = getAvailableEvents(referenceLabel, null, analysisFiles);
  } else {
    const val = valSel.value;
    evts = getAvailableEvents(cond, val, analysisFiles);
  }

  // Sort according to our fixed ordering
  evts.sort((a, b) => eventOrder.indexOf(a) - eventOrder.indexOf(b));

  // Populate dropdown in consistent order
  evts.forEach(e => evtSel.add(new Option(eventLabels[e] || e, e)));

  updateImages();
}

/* ---- Update images ---- */
function updateImages() {
  const cond = condSel.value;
  const evt = evtSel.value;
  const analysisFolder = `plots/${analysisSel.value}/Contours-Hists/`;
  const analysisFolder2D = `plots/${analysisSel.value}/2Dhists/`;
  let filename = "";
  let filename2d = "";

  if (cond === referenceLabel) {
    filename = `ref-${evt}.png`;
    filename2d = "xG-ref.png";
  } else {
    const val = valSel.value;
    filename = `${cond}-${val}-${evt}.png`;
    filename2d = `${cond}-${val}.png`;
  }

  const analysisFiles = fileMap[analysisSel.value];
  img.src = analysisFiles.includes(filename) ? `${analysisFolder}${filename}` : "";
  img2d.src = filename2d ? `${analysisFolder2D}${filename2d}` : "";
}


function updateAnalysisDescription() {
  const descElem = document.getElementById("analysis-description");
  const selected = analysisSel.value;
  descElem.innerHTML = analysisDescriptions[selected] || "";
}


/* ---- Event listeners ---- */
analysisSel.addEventListener("change", updateConditionDropdown);
analysisSel.addEventListener("change", updateAnalysisDescription);
condSel.addEventListener("change", updateValueDropdown);
valSel.addEventListener("change", updateEventDropdown);
evtSel.addEventListener("change", updateImages);

/* ---- Download buttons ---- */
downloadBtn.addEventListener("click", () => {
  if (!img.src) return;
  const link = document.createElement("a");
  link.href = img.src;
  link.download = img.src.split("/").pop();
  link.click();
});

download2dBtn.addEventListener("click", () => {
  if (!img2d.src) return;
  const link = document.createElement("a");
  link.href = img2d.src;
  link.download = img2d.src.split("/").pop();
  link.click();
});

/* ---- Toggle visibility buttons ---- */
toggleContoursBtn.addEventListener("click", () => {
  contoursContainer.style.display = contoursContainer.style.display === "none" ? "block" : "none";
});

toggle2dBtn.addEventListener("click", () => {
  hist2dContainer.style.display = hist2dContainer.style.display === "none" ? "block" : "none";
});
</script>

</body>
</html>
