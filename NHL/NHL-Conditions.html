<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Shot Histogram Viewer</title>
<style>
    body {
        font-family: Arial;
        /*padding: 10px;*/
        /*max-width: 1000px;*/
        margin: auto;
    }

    .controls {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 10px;
    }

    select, button {
        padding: 8px;
        font-size: 1rem;
    }

    .plots-wrapper {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        justify-content: center;
    }

    .plot-container {
        text-align: center;
        flex: 1 1 400px;
    }

    img {
        max-width: 100%;
        height: auto;
        border: 1px solid #ddd;
        padding: 6px;
        margin-top: 10px;
    }

    @media (max-width: 850px) {
    .plots-wrapper { flex-direction: column; }
    }

    /* Style the header */
    .header {
        padding: 40px;
        text-align: center;
        background: #00578d;
        color: white;
        border-bottom: solid black
    }

        /* Increase the font size of the h1 element */
        .header h1 {
            font-size: 34px;
        }

        /* Set the font size of the p element */
        .header p {
            font-size: 20px;
        }

        /* Set the link colours */
        /* unvisited */
        .header a:link{
            color: yellow;
        }
        .header a:visited{
            color: black;
        }
        .header a:hover{
            color: yellow;
        }


    /* Main column */
    .main {
            flex: 80%; /* Set the width of the main content */
            background-color: white; /* White background color */
            padding-top: 40px;
            padding-left: 20%;
            padding-right: 20%;
            line-height: 1.5;
        }

            /* Increase the font size of the h1 element */
            .main h1 {
                padding-top: 16px;
                font-size: 16px;
                font-weight: bold;
                text-decoration: underline;
            }
</style>
</head>
<body>

<div class="header">
    <h1>The effect of various conditions on shot outcomes in the NHL</h1>
    <p><a href="https://github.com/rucskajj/Data-Science-Projects/tree/main/NHL/xG">Link to code</a></b></p>
    <p>Joey Rucska</p>
    <p>Last updated on November 11, 2025.</p>
</div>



<div class="main">

    <h2>Plot Viewer</h2>

    <!-- Analysis Dropdown -->
    <div class="controls">
    <label for="analysis-select">Analysis:</label>
    <select id="analysis-select"></select>
    </div>

    <!-- Condition, Value, Event Dropdowns + Contours-Hists Download Button -->
    <div class="controls">
    <select id="condition-select"></select>
    <select id="value-select"></select>
    <select id="event-select"></select>
    </div>

    <!-- Toggle Buttons -->
    <div class="controls">
    <button id="toggle-contours">Show/Hide Contours-Hists</button>
    <button id="toggle-2d">Show/Hide 2D Histogram</button>
    </div>

    <!-- Plots wrapper -->
    <div class="plots-wrapper">
    <!-- Contours-Hists Plot -->
    <div class="plot-container" id="contours-container">
        <h3>Contours-Hists Plot</h3>
        <img id="hist-img" src="" alt="Contours Histogram">
        <div class="controls" style="justify-content:center; margin-top:10px;">
        <button id="download-btn">Download Contours-Hists Plot</button>
        </div>
    </div>

    <!-- 2Dhists Plot -->
    <div class="plot-container" id="hist2d-container">
        <h3>2D Histogram Plot</h3>
        <img id="hist2d-img" src="" alt="2D Histogram">
        <div class="controls" style="justify-content:center; margin-top:10px;">
        <button id="download2d-btn">Download 2D Histogram Plot</button>
        </div>
    </div>
    </div>

</div>

<script>
/* ---- Human-readable labels ---- */
const conditionLabels = {
  PlayingStrength: "Strength Situation",
  anglesign: "Shot Angle Side",
  bForwardPlayer: "Forward Shooter",
  bOffWing: "Off-Wing Shot",
  bPlayoffs: "Playoff Game",
  bReb: "Rebound Shot",
  type: "Shot Type"
};

const valueLabels = {
  "-1": "Left/Negative",
  "1": "Right/Positive",
  "0": "No/False",
  "3v3": "3v3",
  "4v4": "4v4",
  "4v5": "4v5 (PK)",
  "5v3": "5v3 (PP)",
  "5v4": "5v4 (PP)",
  "5v5": "5v5 (Even)",
  "6v5": "6v5 (Extra Attacker)",
  BACK: "Backhand",
  DEFL: "Deflection",
  SLAP: "Slap Shot",
  SNAP: "Snap Shot",
  TIP: "Tip-In",
  WRAP: "Wraparound",
  WRIST: "Wrist Shot"
};

const eventLabels = {
  SAT: "Shot Attempts",
  SOG: "Shots on Goal",
  goal: "Goals",
  miss: "Missed Shots"
};

/* ---- DOM elements ---- */
const analysisSel = document.getElementById("analysis-select");
const condSel = document.getElementById("condition-select");
const valSel = document.getElementById("value-select");
const evtSel = document.getElementById("event-select");
const img = document.getElementById("hist-img");
const img2d = document.getElementById("hist2d-img");
const downloadBtn = document.getElementById("download-btn");
const download2dBtn = document.getElementById("download2d-btn");
const contoursContainer = document.getElementById("contours-container");
const hist2dContainer = document.getElementById("hist2d-container");
const toggleContoursBtn = document.getElementById("toggle-contours");
const toggle2dBtn = document.getElementById("toggle-2d");

/* ---- Reference dataset ---- */
const referenceLabel = "ref";

/* ---- Load file map ---- */
let fileMap = {}; 

fetch("analyses_filemap.json")
  .then(response => response.json())
  .then(data => {
    fileMap = data;

    Object.keys(fileMap).forEach(a => {
      analysisSel.add(new Option(a, a));
    });

    updateConditionDropdown();
  });

/* ---- Helper functions ---- */
function getAvailableConditions(analysisFiles) {
  const conds = new Set();
  analysisFiles.forEach(f => {
    const parts = f.split("-");
    if (parts[0] !== "ref") conds.add(parts[0]);
  });
  return Array.from(conds);
}

function getAvailableValues(cond, analysisFiles) {
  const values = new Set();
  analysisFiles.forEach(f => {
    const parts = f.split("-");
    if (parts[0] === cond) values.add(parts[1]);
  });
  return Array.from(values);
}

function getAvailableEvents(cond, val, analysisFiles) {
  const evts = new Set();
  analysisFiles.forEach(f => {
    const parts = f.split("-");
    if (cond === referenceLabel) {
      if (f.startsWith("ref-")) evts.add(parts[1].replace(".png",""));
    } else if (parts[0] === cond && parts[1] === val) {
      evts.add(parts[2].replace(".png",""));
    }
  });
  return Array.from(evts);
}

/* ---- Update Dropdowns ---- */
function updateConditionDropdown() {
  condSel.innerHTML = "";

  const analysisFiles = fileMap[analysisSel.value];
  condSel.add(new Option("Reference Data", referenceLabel));
  const conds = getAvailableConditions(analysisFiles);
  conds.forEach(c => condSel.add(new Option(conditionLabels[c] || c, c)));

  updateValueDropdown();
}

function updateValueDropdown() {
  const cond = condSel.value;
  const analysisFiles = fileMap[analysisSel.value];

  if (cond === referenceLabel) {
    valSel.style.display = "none";
  } else {
    valSel.style.display = "inline-block";
    valSel.innerHTML = "";
    const values = getAvailableValues(cond, analysisFiles);
    values.forEach(v => valSel.add(new Option(valueLabels[v] || v, v)));
  }

  updateEventDropdown();
}

function updateEventDropdown() {
  evtSel.innerHTML = "";
  const cond = condSel.value;
  const analysisFiles = fileMap[analysisSel.value];

  let evts = [];
  if (cond === referenceLabel) {
    evts = getAvailableEvents(referenceLabel, null, analysisFiles);
  } else {
    const val = valSel.value;
    evts = getAvailableEvents(cond, val, analysisFiles);
  }

  evts.forEach(e => evtSel.add(new Option(eventLabels[e] || e, e)));
  updateImages();
}

/* ---- Update images ---- */
function updateImages() {
  const cond = condSel.value;
  const evt = evtSel.value;
  const analysisFolder = `plots/${analysisSel.value}/Contours-Hists/`;
  const analysisFolder2D = `plots/${analysisSel.value}/2Dhists/`;
  let filename = "";
  let filename2d = "";

  if (cond === referenceLabel) {
    filename = `ref-${evt}.png`;
    filename2d = "xG-ref.png";
  } else {
    const val = valSel.value;
    filename = `${cond}-${val}-${evt}.png`;
    filename2d = `${cond}-${val}.png`;
  }

  const analysisFiles = fileMap[analysisSel.value];
  img.src = analysisFiles.includes(filename) ? `${analysisFolder}${filename}` : "";
  img2d.src = filename2d ? `${analysisFolder2D}${filename2d}` : "";
}

/* ---- Event listeners ---- */
analysisSel.addEventListener("change", updateConditionDropdown);
condSel.addEventListener("change", updateValueDropdown);
valSel.addEventListener("change", updateEventDropdown);
evtSel.addEventListener("change", updateImages);

/* ---- Download buttons ---- */
downloadBtn.addEventListener("click", () => {
  if (!img.src) return;
  const link = document.createElement("a");
  link.href = img.src;
  link.download = img.src.split("/").pop();
  link.click();
});

download2dBtn.addEventListener("click", () => {
  if (!img2d.src) return;
  const link = document.createElement("a");
  link.href = img2d.src;
  link.download = img2d.src.split("/").pop();
  link.click();
});

/* ---- Toggle visibility buttons ---- */
toggleContoursBtn.addEventListener("click", () => {
  contoursContainer.style.display = contoursContainer.style.display === "none" ? "block" : "none";
});

toggle2dBtn.addEventListener("click", () => {
  hist2dContainer.style.display = hist2dContainer.style.display === "none" ? "block" : "none";
});
</script>

</body>
</html>
